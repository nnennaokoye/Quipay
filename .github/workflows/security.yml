name: Security Analysis

on:
  push:
    branches: ["main"]
  pull_request:

env:
  CARGO_TERM_COLOR: always

jobs:
  fuzzing:
    name: Automated Fuzzing
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Manual Fuzzing Harness
        run: |
          cd contracts/payroll_vault
          cargo test test_manual_fuzz -- --nocapture

  symbolic-execution:
    name: Symbolic Execution (Kani)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Kani
        run: |
          cargo install --locked kani-verifier
          cargo kani setup
      - name: Run Kani Proofs
        run: |
          cd contracts/payroll_vault
          cargo kani
